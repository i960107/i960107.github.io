---
title: 네트워크 전송계층
tags:
- 23년 2월
- CS
- 알고리즘
author: 수현
---
## 전송계층: 신뢰할 수 있는 데이터 전송하기

- 키워드: 연결형 통신, 비연결형 통신, TCP, UDP, 3Way Handshake, 세그먼트, 신뢰성/효율성, 일려번호, 확인응답번호, 윈도우 크기, 버퍼, 재전송 제어, 포트번호, 데이터그램

### 전송 계층의 역할

- 물리계층, 데이터 링크 계층, 네트워크 계층의 3계층이 있으면 목적지에 데이터를 보낼 수 있지만, 데이터가 손상되거나 유실되더라도 이들 계층에서는 아무것도 해주지 않음.
- **전송 계층**은 목적지에 **신뢰할 수 있는 데이터를 전달**하기 위해 필요.
    1. 오류를 점검하는 기능: 오류가 발생하면 데이터를 재전송
    2. 전송된 데이터의 목적지가 어떤 어플리케이션인지 식별하는 기능.
- 전송 계층의 특징
    - **신뢰성/정확성**: 데이터를 목적지에 **문제 없이** 전달. 연결형 통신. 상대편과 확인해가면서 통신하는 방식. TCP(Transmission Control Protocol)사용
    - **효율성**: 데이터를 **빠르고** 효율적으로 전달.비연결형통신. 상대편을 확인하지 않고 일방적으로 데이터를 전송하는 방식. 동영상에서 많이 사용. UDP(UserDatagram Protocol) 사용.

### TCP의 구조

- TCP로 전송할때 붙이는 헤더를 **TCP헤더**라고 하고, TCP헤더가 붙은 데이터를 **세그먼트**라고 함.
    - 출발지 포트 번호
    - 목적지 포트 번호
    - 체크섬
    - 코드비트
    - 일련번호, 확인 응답 번호
- 데이터를 전송하려면 먼저 **연결**이라는 **가상의 독점 통신로를 확보**
    - **코드 비트**(6비트)에 연결의 제어 정보를 기록: 연결 확립에는 연결 요청 **SYN**, 확인 응답 **ACK가 필요**
- 3 Way HandShake: **연결을 확립**하기 위해 패킷 요청을 세 번 교환
    1. A→B 연결 확립 요청: SYN 1로 활성화
    1. B → A연결 확립 응답 + 연결 확립 요청: SYN, ACK가 1로 활성화
    2. A → B연결 확립 응답: ACK가 1로 활성화
    - 데이터를 전송한 후에는 연결을 끊기 위한 요청을 교환해야 함. FIN과 ACK를 사용
    - 윈도우 사이즈와, 일련번호, 확인응답 번호를 결정.

### 일련 번호와 확인 응답 번호의 구조

- TCP는 **데이터를 분할**해서 보내는데 **송신 측**에서 일련번호로 ‘이 데이터가 몇 번째 데이터인지’인지 알려주고,  **수신 측에서**는 **확인 응답 번호**로  몇 번째 데이터를 수신했는지 알려며, 다음 데이터를 요청한다.
    - 일련번호(sequence number)
    - 확인 응답 번호(acknowledgement number)
    - 3 way 핸드셰이크로 연결 확립이 이루어질때, 이번 통신에 사용하는 일련번호와 확인응답 번호가 결정된다.
    - 일련번호와 확인 응답 번호를 사용해서 데이터가 손상되거나 유실된 경우 데이터를 재전송함.(**재전송 제어**)

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/ac0feba0-bc4e-48df-84ba-07be50d94bb0/Untitled.png)

- **윈도우 크기**와 구조
    - 매번 데이터를 보낼 때마다 확인 응답을 반환 받고 다음 데이터를 보내면 효율이 높지 않음.
    - 응답을 기다리지 않고(비동기) 세그먼트를 연속해서 보내고 난 다음에 확인 응답을 반환하면 효율이 높음.
    - 수신 측은 받은 세그먼트를 **버퍼**에 일시적으로 보관. 수신 측에서 버퍼보다 큰 데이터를 전송받으면 **오버플로**가 발생. 오버플로가 발생하지 않도록 **버퍼의 한계 크기**(윈도우 사이즈)를 알고 있어야 함. 즉, 확인 응답을 일일이 하지 않고 연속해서 수신할 수 있는 데이터 크기.

### 포트 번호의 구조

- 데이터의 목적지가 어떤 프로그램인지 구분하는 역할.
- **포트번호**란? 포트번호를 사용해서 어플리케이션을 구분. 0 ~ 65535.
    - **well known port**: 0 ~ 1023번 포트는 주요 프로토콜이 사용하도록 예약되어 있음. 일반적으로 사용하는 서버 측 어플리케이션 ex) springboot 8080, http 80, https443, ssh 22
    - 1024는 예약되어 있지만 사용되지는 않음
    - 1025이후는 **random port**라고 함.
    - **웹 브라우저에**는 접속할때 임의의 포트가 **자동으로 할당**됨, 서버 측에서는 포트 번호를 정해 둬야 하지만, 클라이언트 측은 정하지 않아도 됨

### UDP의 구조

- 전송 계층에서 효율적으로 통신할 수 있도록 돕는 UDP 프로토콜
- 데이터를 **효율적으로 빠르게 보내기 위해**  수신확인을 하지 않는 **비연결형 통신을** 사용함 . 스트리밍방식으로 전송하는 동영상서비스에서 사용됨.
- UDP헤더란?
    - **UDP헤더**가 붙은 데이터를 **UDP 데이터그램**이라고 함